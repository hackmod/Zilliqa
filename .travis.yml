language: generic
cache:
  directories:
    - $HOME/.ccache/

matrix:
  include:
    - os: linux
      dist: xenial
    # - os: osx
    #  osx_image: xcode10.1

addons:
  apt:
    update: true
    packages:
    # APT packages are organized into two groups, build dependency and 
    # development dependency, where the former is necessary for users who
    # want to build Zilliqa whereas the latter is only for CI.
    # Note that the names are sorted in each group.
    #
    # Build dependency
    - build-essential
    - cmake
    - libboost-filesystem-dev
    - libboost-program-options-dev
    - libboost-system-dev
    - libboost-test-dev
    - libboost-python-dev
    - libcurl4-openssl-dev
    - libevent-dev
    - libjsoncpp-dev
    - libjsonrpccpp-dev
    - libleveldb-dev
    - libmicrohttpd-dev
    - libminiupnpc-dev
    - libsnappy-dev
    - libssl-dev
    - pkg-config
    # Development dependency
    - ccache
    - clang-5.0
    - clang-format-5.0
    - clang-tidy-5.0
    - curl
    - gawk
    - git
    - lcov
    - libxml2-utils
    - python-pip

script:
  - ./scripts/ci_build.sh;
  - cmake --build build --target package -- -j4

# Code coverage is currently only implemented for GCC builds, so OSX is currently excluded from reporting
after_success:
  - ./scripts/ci_report_coverage.sh

deploy:
  - provider: releases
    api_key:
      secure: "URkCxi2Ekjw+gJc3Di38mkvXHXeaBgVf99cIPMsD3Oh3Ac6Ire4KYX3pqIDyO4SoQeSrxmJKyvI0ZFcjvd/B9cWF09BWExPS812ttPxJO1yoiDPVNAdOI4zoaqN8ffNq6bXguILx++GhlpCS+1W3yi148OowlC4WImSxwQLIpDK7z4THzmAazFC2r7ojTvfz92oNcWhET5yymQkDDEk6o+3AOAaMlOwMuXRUyOcd1+hqVTnkrafHAStAwec5JibxmfFqxpoGkDWRhD6OdoHncs0KCih2ZnePoFhOlc1u88av9kOYVcfLYpHI77wyqTmn28s/s1in8Mxy2n3Yz0AgAkbklpe3h2EIKLsuUX1fHgZxEC7qeWo4eJfPUnD1fthYvk7i8dBcMOpLq9QdphD6R+i04ZixBuRfO0q+Lopt+D3gk5xVofgUUNAYbjigTf9iXNo/g9wmA9rkVeK9HcdWsAQdf2jsEYVmxgIkkKx58HoCyCxu5sDVkbvhRwAMRp9Lra542jvTlhnKRL/sGir/z531lk62fGmGsEpxlMrdett4Ac+ZBf0l+pV3lsDeuGFlSrw82/k2qwCOP5kDjiE9557mHnBQ1ew5V+J50jSm39Bhw0qGptchW2kcvNRlsF1cZ85B+vYpOnh5Z9eGkOyZGokrIaeYwtuAe0wdayKnSpg="
    file_glob: true
    file: build/*.deb
    skip_cleanup: true
    on:
      tags: true
